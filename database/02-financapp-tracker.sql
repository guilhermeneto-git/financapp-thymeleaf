CREATE DATABASE  IF NOT EXISTS `financapp`;
USE `financapp`;

-- Drop all of tables.
DROP TABLE IF EXISTS `accounts`;
DROP TABLE IF EXISTS `categories`;
DROP TRIGGER IF EXISTS `trg_users_insert`;
DROP TRIGGER IF EXISTS `trg_users_delete`;
DROP TABLE IF EXISTS `roles`;
DROP TABLE IF EXISTS `users`;

-- Table structure for table `users`
CREATE TABLE `users` (
	`user_id` varchar(50) NOT NULL,
    `name` varchar (100) NOT NULL,
    `email` varchar (80) NOT NULL,
    `password` varchar (80) NOT NULL,
    `active` tinyint NOT NULL,
    
    PRIMARY KEY (`user_id`),
    UNIQUE (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- Inserting data for table `users`
-- passwords generated by https://www.bcryptcalculator.com/encode site
-- passwords values as 'financapp' for the users below
INSERT INTO `users`
VALUES
('guilherme', 'Guilherme Neto','guilherme.neto@financapp.com', '{bcrypt}$2a$10$GwlNZsV5mDTOK2gBqx7nLOHZ384cpaN19GR.8X.7bl/donqV0RomC', 1),
('peter', 'Peter Hills', 'peter.hills@financapp.com', '{bcrypt}$2a$10$GwlNZsV5mDTOK2gBqx7nLOHZ384cpaN19GR.8X.7bl/donqV0RomC', 1);

-- Table structure for table `role`
CREATE TABLE `roles` (
  `user_id` varchar(50) NOT NULL,
  `role` varchar(50) NOT NULL,
  UNIQUE KEY `authorities5_idx_1` (`user_id`,`role`),
  CONSTRAINT `authorities5_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- Inserting data for table `roles`
INSERT INTO `roles`
VALUES
('guilherme','ROLE_ADMIN'),
('guilherme','ROLE_USER'),
('peter','ROLE_USER');

-- Trigger insert the user into the role as USER when the user was inserted into the user table.
CREATE TRIGGER `trg_users_insert` AFTER INSERT
ON `users` FOR EACH ROW INSERT INTO `roles`(user_id, role) VALUES (NEW.user_id, 'ROLE_USER');

-- Trigger delete the user into the role as USER before the user was deleted into the user table.
CREATE TRIGGER `trg_users_delete` BEFORE DELETE
ON `users` FOR EACH ROW DELETE FROM `roles` WHERE user_id = OLD.user_id;

-- Table structure for table `category`
CREATE TABLE `categories` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

INSERT INTO `categories`
(name)
VALUES
('Food'),
('Car'),
('Salary'),
('House');


-- Table structure for table `account`
CREATE TABLE `accounts` (
	`id` int NOT NULL AUTO_INCREMENT,
    `user_id` varchar(50) NOT NULL,
    `category_id` int NOT NULL,
    `type` varchar(50) NOT NULL,
    `name` varchar(80) NOT NULL,
    `description` varchar (200),
    `total` decimal(9,2),
    `due_date` date,
    `payed` tinyint,
    
    PRIMARY KEY (`id`),
    FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`),
    FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

INSERT INTO `accounts`
(user_id, category_id, type, name, description, total, due_date, payed)
VALUES
('guilherme', 1, 'EXPENSE', 'Restaurant', null, 85.3, '2025-03-17', 1),
('guilherme', 2, 'EXPENSE', 'Fuel', null, 20.54, '2025-03-18', 1),
('guilherme', 1, 'EXPENSE', 'Super Market', null, 130, '2025-03-18', 1),
('guilherme', 2, 'EXPENSE', 'Manutance', null, 875, '2025-03-30', 0),
('guilherme', 3, 'INCOME', 'BayresDev', null, 3000, '2025-05-03', 0),
('guilherme', 4, 'EXPENSE', 'Chair', null, 150, '2025-03-15', 0),
('peter', 1, 'EXPENSE', 'Chocolatte', null, 5.99, '2025-05-16', 1);
